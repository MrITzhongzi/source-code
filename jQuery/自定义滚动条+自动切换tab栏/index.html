<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>自定义滚动条</title>
    <link rel="stylesheet" href="source/reset.css"/>
    <style>
        body {
            background: #ccc;
        }

        .scroll-demo {
            width: 540px;
            border: 1px solid #000;
            background: #ffffff;
            margin: 30px auto;
            position: relative;
        }

        /*标签切换区域样式*/
        .scroll-tab {
            height: 34px;
            border-bottom: 1px solid #e5e5e5;
            color: #666;
            background: #F8F8F8;
        }

        .scroll-tab .tab-item {
            float: left;
            font: 14px/34px '微软雅黑';
            height: 34px;
            text-align: center;
            border-right: 1px solid #e5e5e5;
            padding: 0 20px;
        }

        .scroll-tab .tab-active {
            color: green;
            background: #ffffff;
            border-top: 2px solid green;
            margin: -1px 0;
        }

        .scroll-wrap {
            width: 100%;
            height: 300px;
            position: relative;
            overflow: hidden;
        }

        .scroll-wrap .scroll-cont {
            /*height: 100%;*/
            padding: 0 15px;
            overflow: hidden;
        }

        .scroll-wrap .scroll-cont h3 {
            font: 16px/3 'Microsoft Yahei';
            text-align: center;
        }

        .scroll-wrap .scroll-cont p {
            font-size: 14px;
            line-height: 20px;
            text-indent: 2em;
            margin-bottom: 10px;
        }

        .scroll-bar {
            position: absolute;
            top: 0;
            right: 0;
            width: 10px;
            height: 100%;
            background-color: #eaeaea;
        }

        .scroll-slider {
            position: absolute;
            top: 0;
            left: 1px;
            width: 8px;
            height: 30px;
            background:  orange;
        }
    </style>
</head>
<body>
<!--示例容器-->
<div class="scroll-demo">
    <!--标签切换区-->
    <ul class="scroll-tab clearfix">
        <li class="tab-item tab-active">第一篇</li>
        <li class="tab-item">第二篇</li>
        <li class="tab-item">第三篇</li>
        <li class="tab-item">第四篇</li>
    </ul>
    <!--滚动内容区-->
    <div class="scroll-wrap">
        <!--滚动内容-->
        <div class="scroll-cont">
            <h3 class="anchor">春天来了</h3>

            <div class="scroll-ol">
                <p>穿天来了冬天还会远么</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>
            </div>
            <h3 class="anchor">夏天来了</h3>

            <div class="scroll-ol">
                <p>夏天来了冬天还会远么</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>
            </div>
            <h3 class="anchor">秋天来了</h3>

            <div class="scroll-ol">
                <p>秋天来了冬天还会远么</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>
            </div>
            <h3 class="anchor">冬天来了</h3>

            <div class="scroll-ol">
                <p>冬天来了冬天还会远么</p>

                <p>
                    到了农历的年末，城市的超市里挂满了玲珑华美的红灯笼，玻璃橱窗上也贴上了各式花样的剪纸，这些都是年的符号，也是年的名片。我内心深藏的年味儿犹如一只脆弱不堪的老酒坛被这些符号与名片猛然击碎，老酒倾泻满地，浓郁醇厚的味道漫然飘散。</p>
            </div>

            <!--矫正最后一篇文章位置的占位元素-->
            <div class="correct-bot"></div>
        </div>

    </div>
    <!--滚动条-->
    <div class="scroll-bar">
        <!--滑块-->
        <div class="scroll-slider"></div>
    </div>
</div>
</body>
<script src="source/jquery-2.1.4.js"></script>
<script>
    (function (win, doc, $) {
        function CusScrollBar(options) {

            this._init(options);
        }

        $.extend(CusScrollBar.prototype, {
            _init: function (options) {
                var self = this;
                self.options = {
                    scrollDir: "y", //滚动方向默认垂直
                    contSelector: "", //滚动区内容选择器
                    barSelector: "",  //滚动条选择器
                    sliderSelector: "", //滚冬滑块选择器
                    tabItemSelector: '.tab-item', //标签选择器
                    tabActiveClass: 'tab-active', //选中标签类名
                    anchorSelector: '.anchor',
                    wheelStep: 10, //滚轮步长
                    correctSelector: '.correct-bot',//校正元素
                    articleSelector: '.scroll-ol' //文章选择器
                };
                $.extend(true, self.options, options || {});
                console.log(self.options.contSelector);
                self._initDomEvent();
                return self;
            },
            /**
             * 初始化DOM引用
             **/
            _initDomEvent: function () {
                var opts = this.options;
                //滚动区对象，必须填
                this.$cont = $(opts.contSelector);
                //滚动条滑块对象，必须填
                this.$slider = $(opts.sliderSelector);
                //滚动条对象
                this.$bar = opts.barSelector ?
                        $(opts.barSelector) :
                        self.$slider.parent();
                //标签项
                this.$tabItem = $(opts.tabItemSelector);

                //锚点项
                this.$anchor = $(opts.anchorSelector);

                //正文
                this.$article = $(opts.articleSelector);

                //校正元素对象
                this.$correct = $(opts.correctSelector);

                //获取文档对象
                this.$doc = $(doc);

                this._initSliderDragEvent().
                        _bindContScroll().
                        _bindMousewheel().
                        _initTabEvent().
                        _initArticleHeight();
            },
            //初始化文档的高度
            _initArticleHeight: function () {
                var self = this,
                        lastArticle = self.$article.last();

                var lastArticleHeight = lastArticle.height(),
                        contHeight = self.$cont.height();

                if (lastArticleHeight < contHeight) {
                    self.$correct[0].style.height = contHeight
                            - lastArticleHeight - self.$anchor.outerHeight() + 'px';
                }
                return self;
            },
            /*
             初始化滑块的拖动功能
             * */
            _initSliderDragEvent: function () {
                var slider = this.$slider,
                        sliderEl = slider[0];
                var self = this;
                if (sliderEl) {
                    var doc = this.$doc,
                            dragStartPagePosition,
                            dragStartScrollPosition,
                            dragContBarRate;

                    function mousemoveHandler(e) {
                        e.preventDefault();
                        console.log('move');
                        if (dragStartPagePosition == null) {
                            return;
                        }
                        self.scrollTo(dragStartScrollPosition +
                                (e.pageY - dragStartPagePosition) *
                                dragContBarRate);
                    }

                    slider.on('mousedown', function (e) {
                        e.preventDefault();
                        console.log("down");
                        dragStartPagePosition = e.pageY;
                        console.log(self.$cont);
                        dragStartScrollPosition =
                                self.$cont[0].scrollTop;

                        console.log(self.getMaxScrollPosition());
                        dragContBarRate = self.getMaxScrollPosition() / self.getMaxSliderPosition();

                        doc.on('mousemove.scroll', mousemoveHandler).on('mouseup.scroll', function (e) {
                            console.log('up');
                            doc.off('.scroll');
                        });
                    });
                }

                return self;
            },
            /*
             * 初始化标签切换功能
             * */
            _initTabEvent: function () {
                var self = this;
                self.$tabItem.on('click', function (e) {
                    e.preventDefault();

                    var index = $(this).index();
                    console.log(index);
                    self.changeTabSelect(index);

                    //已经滚出可视区的高度
                    // + 指定锚点与内容容器距离
                    self.scrollTo(self.$cont[0].scrollTop +
                            self.getAnchorPosition(index));
                });
                return self;
            },
            /*
             * 切换标签
             * */
            changeTabSelect: function (index) {
                var self = this,
                        active = self.options.tabActiveClass;
                return self.$tabItem.eq(index).addClass(active).siblings().removeClass(active);
            },
            //监听内容的滚动，同步滑块
            _bindContScroll: function () {
                var self = this;
                self.$cont.on('scroll', function () {
                    var sliderEl = self.$slider &&
                            self.$slider[0];
                    if (sliderEl) {
                        sliderEl.style.top = self.
                                        getSliderPosition() + 'px';
                    }
                });
                return self;
            },
            _bindMousewheel: function () {
                var self = this;
                self.$cont.on('mousewheel DOMMouseScroll',
                        function (e) {
                            e.preventDefault();
                            var oEv = e.originalEvent,
                                    wheelRange = oEv.wheelDelta ? -oEv.
                                            wheelDelta / 120 :
                                    (oEv.detail || 0) / 3;
                            self.scrollTo(self.$cont[0].scrollTop +
                                    wheelRange * self.options.wheelStep);
                        })

                return self;
            },
            //获取锚点到上边界的像素数
            getAnchorPosition: function (index) {
                return this.$anchor.eq(index).position().top;
            },
            //获取每个锚点位置信息的数组
            getAllAnchorPosition: function () {
                var self = this,
                        allPositionArr = [];
                for (var i = 0; i < self.$anchor.length; i++) {
                    allPositionArr.push(self.$cont[0].scrollTop +
                            self.getAnchorPosition(i));
                }
                return allPositionArr;
            },
            //计算滑块的当前位置
            getSliderPosition: function () {
                var self = this,
                        maxSliderPosition =
                                self.getMaxSliderPosition();
                return Math.min(maxSliderPosition,
                        maxSliderPosition * self.
                                $cont[0].scrollTop / self.getMaxScrollPosition())
            },
            /*
             * 内容可滚动的高度
             * */
            getMaxScrollPosition: function () {
                var self = this;
                return Math.max(self.$cont.height(), self.$cont[0].scrollHeight) - self.$cont.height();
            },
            /*
             * 滑块可移动距离
             * */
            getMaxSliderPosition: function () {
                var self = this;
                return self.$bar.height() -
                        self.$slider.height();
            },
            /*
             *
             * */
            scrollTo: function (positionVal) {
                var self = this;
                var posArr = self.getAllAnchorPosition();
                //滚动条的位置与tab标签的对应
                function getIndex(positionVal) {
                    for (var i = posArr.length - 1; i >= 0; i--) {
                        if(positionVal >= posArr[i]){
                            return i;
                        }else{
                            continue;
                        }
                    }
                }
                //锚点数和标签数相同
                if(posArr.length == self.$tabItem.length){
                    self.changeTabSelect(getIndex(positionVal))
                }
                self.$cont.scrollTop(positionVal);
            }
        });
        /*CusScrollBar.prototype._init = function(){
         console.log('test');
         }*/
        win.CusScrollBar = CusScrollBar;
    })(window, document, jQuery);


    new CusScrollBar({
        contSelector: ".scroll-wrap", //滚动区内容选择器
        barSelector: ".scroll-bar",  //滚动条选择器
        sliderSelector: ".scroll-slider" //滚冬滑块选择器
    });
</script>
</html>